---
// CodeBlock.astro - 복사 버튼이 있는 코드 블록 컴포넌트
---

<script>
  // 페이지 로드 후 코드 블록에 복사 버튼 추가
  document.addEventListener('DOMContentLoaded', function() {
    const codeBlocks = document.querySelectorAll('pre');
    
    codeBlocks.forEach((pre, index) => {
      // 이미 복사 버튼이 있는 경우 건너뛰기
      if (pre.querySelector('.copy-button')) return;
      
      // 복사 버튼 컨테이너 생성
      const copyButtonContainer = document.createElement('div');
      copyButtonContainer.className = 'copy-button-container';
      
      // 복사 버튼 생성
      const copyButton = document.createElement('button');
      copyButton.className = 'copy-button';
      copyButton.innerHTML = `
        <svg class="copy-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
          <path d="m5 15-1-1v-11c0-1.1.9-2 2-2h11l-1 1"></path>
        </svg>
        <span class="copy-text">복사</span>
      `;
      copyButton.setAttribute('aria-label', '코드 복사');
      copyButton.setAttribute('title', '코드 복사');
      
      // 복사 기능 구현
      copyButton.addEventListener('click', async function() {
        const code = pre.querySelector('code');
        if (!code) return;
        
        const text = code.textContent || '';
        
        try {
          await navigator.clipboard.writeText(text);
          
          // 성공 피드백
          copyButton.innerHTML = `
            <svg class="copy-icon success" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="20,6 9,17 4,12"></polyline>
            </svg>
            <span class="copy-text">복사됨!</span>
          `;
          copyButton.classList.add('copied');
          
          // 2초 후 원래 상태로 복구
          setTimeout(() => {
            copyButton.innerHTML = `
              <svg class="copy-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="m5 15-1-1v-11c0-1.1.9-2 2-2h11l-1 1"></path>
              </svg>
              <span class="copy-text">복사</span>
            `;
            copyButton.classList.remove('copied');
          }, 2000);
          
        } catch (err) {
          console.error('클립보드 복사 실패:', err);
          
          // 실패 피드백
          copyButton.innerHTML = `
            <svg class="copy-icon error" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="15" y1="9" x2="9" y2="15"></line>
              <line x1="9" y1="9" x2="15" y2="15"></line>
            </svg>
            <span class="copy-text">실패</span>
          `;
          
          setTimeout(() => {
            copyButton.innerHTML = `
              <svg class="copy-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="m5 15-1-1v-11c0-1.1.9-2 2-2h11l-1 1"></path>
              </svg>
              <span class="copy-text">복사</span>
            `;
          }, 2000);
        }
      });
      
      copyButtonContainer.appendChild(copyButton);
      pre.appendChild(copyButtonContainer);
    });
  });
</script>

<style>
  :global(.copy-button-container) {
    position: absolute;
    top: 0.75rem;
    right: 0.75rem;
    z-index: 10;
  }

  :global(.copy-button) {
    display: flex;
    align-items: center;
    gap: 0.375rem;
    padding: 0.5rem 0.75rem;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 6px;
    color: #e2e8f0;
    font-size: 0.75rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    backdrop-filter: blur(4px);
    font-family: inherit;
  }

  :global(.copy-button:hover) {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
    transform: translateY(-1px);
  }

  :global(.copy-button:active) {
    transform: translateY(0);
  }

  :global(.copy-button.copied) {
    background: rgba(34, 197, 94, 0.2);
    border-color: rgba(34, 197, 94, 0.4);
    color: #10b981;
  }

  :global(.copy-icon) {
    flex-shrink: 0;
    transition: all 0.2s ease;
  }

  :global(.copy-icon.success) {
    color: #10b981;
  }

  :global(.copy-icon.error) {
    color: #ef4444;
  }

  :global(.copy-text) {
    font-size: 0.75rem;
    white-space: nowrap;
  }

  /* 모바일에서는 텍스트 숨기기 */
  @media (max-width: 640px) {
    :global(.copy-text) {
      display: none;
    }
    
    :global(.copy-button) {
      padding: 0.5rem;
    }
  }
</style>